#!/usr/bin/env python3 """ é†«é™¢è—¥ç‰©ç®¡ç†ç³»çµ± - å¢å¼·ç‰ˆæ¸¬è©¦è…³æœ¬ """ import requests import json import time BASE_URL = "http://localhost:8000" def test_enhanced_system(): print(" é†«é™¢è—¥ç‰©ç®¡ç†ç³»çµ± - å¢å¼·ç‰ˆæ¸¬è©¦") print("=" * 50) time.sleep(2) try: # 1. æ¸¬è©¦åŸºæœ¬é€£æ¥ print("1. ğŸ”Œ æ¸¬è©¦åŸºæœ¬é€£æ¥...") response = requests.get(f"{BASE_URL}/api/test") if response.status_code == 200: data = response.json() print(f" æˆåŠŸ: é€£æ¥æˆåŠŸ - {data['message']}") print(f" ğŸ“Š ç³»çµ±çµ±è¨ˆ: {data['system_stats']}") else: print(f" éŒ¯èª¤: é€£æ¥å¤±æ•—: {response.status_code}") return # 2. æ¸¬è©¦è©³ç´°è—¥ç‰©è³‡è¨Š print("\n2. æ¸¬è©¦è©³ç´°è—¥ç‰©è³‡è¨Š...") # ç²å–è©³ç´°è—¥ç‰©è³‡è¨Š response = requests.get(f"{BASE_URL}/api/medicine/detailed/å¿ƒå¾‹éŒ ") if response.status_code == 200: medicine_data = response.json() print(" æˆåŠŸ: æˆåŠŸç²å–å¿ƒå¾‹éŒ è©³ç´°è³‡è¨Š") print(f" åŸºæœ¬è³‡è¨Š: {medicine_data['åŸºæœ¬è³‡è¨Š']['åç¨±']}") print(f" ğŸ¢ å» å•†: {medicine_data['åŸºæœ¬è³‡è¨Š']['å» å•†']}") print(f" åŠ‘é‡: {medicine_data['åŸºæœ¬è³‡è¨Š']['åŠ‘é‡']}") else: print(f" éŒ¯èª¤: ç²å–å¤±æ•—: {response.status_code}") # æœå°‹è—¥ç‰© response = requests.get(f"{BASE_URL}/api/medicine/search/detailed/å¿ƒå¾‹") if response.status_code == 200: search_results = response.json() print(f" æœå°‹çµæœ: æ‰¾åˆ° {len(search_results)} å€‹åŒ¹é…è—¥ç‰©") # 3. æ¸¬è©¦ç—…äººç®¡ç† print("\n3. æ¸¬è©¦ç—…äººç®¡ç†...") # ç²å–æ‰€æœ‰ç—…äºº response = requests.get(f"{BASE_URL}/api/patients/") if response.status_code == 200: patients = response.json() print(f" æˆåŠŸ: æˆåŠŸç²å– {len(patients)} å€‹ç—…äºº") if patients: patient = patients[0] print(f" ğŸ‘¤ ç—…äºº: {patient['name']}, å¹´é½¡: {patient['age']}") # æ–°å¢æ¸¬è©¦ç—…äºº new_patient = { "name": "æ¸¬è©¦ç—…äºº", "age": 30, "gender": "å¥³", "phone": "0987654321", "address": "å°ä¸­å¸‚", "medical_history": "ç„¡ç‰¹æ®Šç—…å²", "current_medications": [], "allergies": "é’é»´ç´ éæ•" } response = requests.post(f"{BASE_URL}/api/patients/", json=new_patient) if response.status_code == 200: created_patient = response.json() print(f" æˆåŠŸ: æˆåŠŸæ–°å¢ç—…äºº ID: {created_patient['id']}") test_patient_id = created_patient['id'] else: print(f" éŒ¯èª¤: æ–°å¢ç—…äººå¤±æ•—: {response.status_code}") test_patient_id = 1 # 4. æ¸¬è©¦ç—…ä¾‹è¨˜éŒ„ print("\n4. æ¸¬è©¦ç—…ä¾‹è¨˜éŒ„...") # æ–°å¢ç—…ä¾‹è¨˜éŒ„ new_record = { "patient_id": test_patient_id, "visit_date": "2024-01-15T10:30:00", "diagnosis": "æ„Ÿå†’", "prescribed_medicines": ["é˜¿æ–¯åŒ¹éˆ 100mg"], "dosage_instructions": "æ¯æ—¥ä¸‰æ¬¡ï¼Œé£¯å¾Œæœç”¨", "doctor_notes": "å¤šä¼‘æ¯ï¼Œå¤šå–æ°´" } response = requests.post(f"{BASE_URL}/api/records/", json=new_record) if response.status_code == 200: created_record = response.json() print(f" æˆåŠŸ: æˆåŠŸæ–°å¢ç—…ä¾‹è¨˜éŒ„ ID: {created_record['id']}") else: print(f" éŒ¯èª¤: æ–°å¢ç—…ä¾‹è¨˜éŒ„å¤±æ•—: {response.status_code}") # ç²å–ç—…äººçš„æ‰€æœ‰è¨˜éŒ„ response = requests.get(f"{BASE_URL}/api/records/patient/{test_patient_id}") if response.status_code == 200: records = response.json() print(f" ç—…äººè¨˜éŒ„æ•¸é‡: {len(records)}") # 5. æ¸¬è©¦JSONå°å‡ºåŠŸèƒ½ print("\n5. æ¸¬è©¦JSONå°å‡ºåŠŸèƒ½...") export_endpoints = [ ("åŸºæœ¬è—¥ç‰©", "/api/export/medicines/basic"), ("è©³ç´°è—¥ç‰©", "/api/export/medicines/detailed"), ("ç—…äººè³‡æ–™", "/api/export/patients"), ("ç—…ä¾‹è¨˜éŒ„", "/api/export/records"), ("å®Œæ•´ç³»çµ±", "/api/export/complete") ] for name, endpoint in export_endpoints: response = requests.get(f"{BASE_URL}{endpoint}") if response.status_code == 200: export_data = response.json() print(f" æˆåŠŸ: {name}å°å‡ºæˆåŠŸ") if 'total_count' in export_data: print(f" ğŸ“Š æ•¸é‡: {export_data['total_count']}") elif 'statistics' in export_data: print(f" ğŸ“Š çµ±è¨ˆ: {export_data['statistics']}") else: print(f" éŒ¯èª¤: {name}å°å‡ºå¤±æ•—: {response.status_code}") # 6. æ¸¬è©¦å¿ƒå¾‹éŒ çš„å®Œæ•´JSONè³‡è¨Š print("\n6. æ¸¬è©¦å¿ƒå¾‹éŒ å®Œæ•´JSONè³‡è¨Š...") response = requests.get(f"{BASE_URL}/api/medicine/detailed/å¿ƒå¾‹éŒ ") if response.status_code == 200: heart_medicine = response.json() print(" æˆåŠŸ: å¿ƒå¾‹éŒ å®Œæ•´è³‡è¨Š:") print(f" JSONæ ¼å¼:") formatted_json = json.dumps(heart_medicine, ensure_ascii=False, indent=2) print(" " + "\n ".join(formatted_json.split("\n")[:15]) + "...") # ä¿å­˜åˆ°æ–‡ä»¶ with open("heart_medicine_info.json", "w", encoding="utf-8") as f: json.dump(heart_medicine, f, ensure_ascii=False, indent=2) print(" ğŸ’¾ å·²ä¿å­˜åˆ° heart_medicine_info.json") print("\n æ‰€æœ‰æ¸¬è©¦å®Œæˆï¼") print("âœ¨ æ–°åŠŸèƒ½éƒ½æ­£å¸¸é‹è¡Œ") print("\n ä½ ç¾åœ¨å¯ä»¥ä½¿ç”¨:") print(" è—¥ç‰©ç®¡ç†: http://localhost:8000/Medicine.html") print(" ç—…äººç®¡ç†: http://localhost:8000/Patients.html") print(" ç—…ä¾‹è¨˜éŒ„: http://localhost:8000/Records.html") print(" ğŸ“– APIæ–‡æª”: http://localhost:8000/docs") print("\n APIä½¿ç”¨ç¯„ä¾‹:") print(" # ç²å–å¿ƒå¾‹éŒ è©³ç´°è³‡è¨Š") print(" curl http://localhost:8000/api/medicine/detailed/å¿ƒå¾‹éŒ ") print("\n # æœå°‹è—¥ç‰©") print(" curl http://localhost:8000/api/medicine/search/detailed/å¿ƒå¾‹") print("\n # å°å‡ºå®Œæ•´ç³»çµ±è³‡æ–™") print(" curl http://localhost:8000/api/export/complete") except requests.exceptions.ConnectionError: print(" éŒ¯èª¤: ç„¡æ³•é€£æ¥åˆ°ä¼ºæœå™¨") print(" æç¤º: è«‹ç¢ºä¿å¢å¼·ç‰ˆä¼ºæœå™¨æ­£åœ¨é‹è¡Œ:") print(" python3 enhanced_server.py") except Exception as e: print(f" éŒ¯èª¤: æ¸¬è©¦å¤±æ•—: {e}") if __name__ == "__main__": test_enhanced_system()