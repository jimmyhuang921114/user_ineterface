#!/usr/bin/env python3 """ 醫院藥物管理系統 - 增強版測試腳本 """ import requests import json import time BASE_URL = "http://localhost:8000" def test_enhanced_system(): print(" 醫院藥物管理系統 - 增強版測試") print("=" * 50) time.sleep(2) try: # 1. 測試基本連接 print("1. 🔌 測試基本連接...") response = requests.get(f"{BASE_URL}/api/test") if response.status_code == 200: data = response.json() print(f" 成功: 連接成功 - {data['message']}") print(f" 📊 系統統計: {data['system_stats']}") else: print(f" 錯誤: 連接失敗: {response.status_code}") return # 2. 測試詳細藥物資訊 print("\n2. 測試詳細藥物資訊...") # 獲取詳細藥物資訊 response = requests.get(f"{BASE_URL}/api/medicine/detailed/心律錠") if response.status_code == 200: medicine_data = response.json() print(" 成功: 成功獲取心律錠詳細資訊") print(f" 基本資訊: {medicine_data['基本資訊']['名稱']}") print(f" 🏢 廠商: {medicine_data['基本資訊']['廠商']}") print(f" 劑量: {medicine_data['基本資訊']['劑量']}") else: print(f" 錯誤: 獲取失敗: {response.status_code}") # 搜尋藥物 response = requests.get(f"{BASE_URL}/api/medicine/search/detailed/心律") if response.status_code == 200: search_results = response.json() print(f" 搜尋結果: 找到 {len(search_results)} 個匹配藥物") # 3. 測試病人管理 print("\n3. 測試病人管理...") # 獲取所有病人 response = requests.get(f"{BASE_URL}/api/patients/") if response.status_code == 200: patients = response.json() print(f" 成功: 成功獲取 {len(patients)} 個病人") if patients: patient = patients[0] print(f" 👤 病人: {patient['name']}, 年齡: {patient['age']}") # 新增測試病人 new_patient = { "name": "測試病人", "age": 30, "gender": "女", "phone": "0987654321", "address": "台中市", "medical_history": "無特殊病史", "current_medications": [], "allergies": "青黴素過敏" } response = requests.post(f"{BASE_URL}/api/patients/", json=new_patient) if response.status_code == 200: created_patient = response.json() print(f" 成功: 成功新增病人 ID: {created_patient['id']}") test_patient_id = created_patient['id'] else: print(f" 錯誤: 新增病人失敗: {response.status_code}") test_patient_id = 1 # 4. 測試病例記錄 print("\n4. 測試病例記錄...") # 新增病例記錄 new_record = { "patient_id": test_patient_id, "visit_date": "2024-01-15T10:30:00", "diagnosis": "感冒", "prescribed_medicines": ["阿斯匹靈 100mg"], "dosage_instructions": "每日三次，飯後服用", "doctor_notes": "多休息，多喝水" } response = requests.post(f"{BASE_URL}/api/records/", json=new_record) if response.status_code == 200: created_record = response.json() print(f" 成功: 成功新增病例記錄 ID: {created_record['id']}") else: print(f" 錯誤: 新增病例記錄失敗: {response.status_code}") # 獲取病人的所有記錄 response = requests.get(f"{BASE_URL}/api/records/patient/{test_patient_id}") if response.status_code == 200: records = response.json() print(f" 病人記錄數量: {len(records)}") # 5. 測試JSON導出功能 print("\n5. 測試JSON導出功能...") export_endpoints = [ ("基本藥物", "/api/export/medicines/basic"), ("詳細藥物", "/api/export/medicines/detailed"), ("病人資料", "/api/export/patients"), ("病例記錄", "/api/export/records"), ("完整系統", "/api/export/complete") ] for name, endpoint in export_endpoints: response = requests.get(f"{BASE_URL}{endpoint}") if response.status_code == 200: export_data = response.json() print(f" 成功: {name}導出成功") if 'total_count' in export_data: print(f" 📊 數量: {export_data['total_count']}") elif 'statistics' in export_data: print(f" 📊 統計: {export_data['statistics']}") else: print(f" 錯誤: {name}導出失敗: {response.status_code}") # 6. 測試心律錠的完整JSON資訊 print("\n6. 測試心律錠完整JSON資訊...") response = requests.get(f"{BASE_URL}/api/medicine/detailed/心律錠") if response.status_code == 200: heart_medicine = response.json() print(" 成功: 心律錠完整資訊:") print(f" JSON格式:") formatted_json = json.dumps(heart_medicine, ensure_ascii=False, indent=2) print(" " + "\n ".join(formatted_json.split("\n")[:15]) + "...") # 保存到文件 with open("heart_medicine_info.json", "w", encoding="utf-8") as f: json.dump(heart_medicine, f, ensure_ascii=False, indent=2) print(" 💾 已保存到 heart_medicine_info.json") print("\n 所有測試完成！") print("✨ 新功能都正常運行") print("\n 你現在可以使用:") print(" 藥物管理: http://localhost:8000/Medicine.html") print(" 病人管理: http://localhost:8000/Patients.html") print(" 病例記錄: http://localhost:8000/Records.html") print(" 📖 API文檔: http://localhost:8000/docs") print("\n API使用範例:") print(" # 獲取心律錠詳細資訊") print(" curl http://localhost:8000/api/medicine/detailed/心律錠") print("\n # 搜尋藥物") print(" curl http://localhost:8000/api/medicine/search/detailed/心律") print("\n # 導出完整系統資料") print(" curl http://localhost:8000/api/export/complete") except requests.exceptions.ConnectionError: print(" 錯誤: 無法連接到伺服器") print(" 提示: 請確保增強版伺服器正在運行:") print(" python3 enhanced_server.py") except Exception as e: print(f" 錯誤: 測試失敗: {e}") if __name__ == "__main__": test_enhanced_system()