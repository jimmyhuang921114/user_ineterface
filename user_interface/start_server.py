#!/usr/bin/env python3 """ 醫院藥物管理系統伺服器啟動腳本 """ from fastapi import FastAPI, HTTPException from fastapi.middleware.cors import CORSMiddleware from fastapi.staticfiles import StaticFiles from fastapi.responses import JSONResponse, FileResponse from pathlib import Path import os import sys # 添加當前目錄到Python路徑 sys.path.append(os.path.dirname(os.path.abspath(__file__))) app = FastAPI(title="醫院藥物管理系統") # CORS設定 app.add_middleware( CORSMiddleware, allow_origins=["*"], allow_credentials=True, allow_methods=["*"], allow_headers=["*"], ) # 設定靜態文件路徑 base_dir = Path(__file__).resolve().parent static_dir = base_dir / "static" # 確保靜態文件目錄存在 static_dir.mkdir(exist_ok=True) (static_dir / "css").mkdir(exist_ok=True) (static_dir / "js").mkdir(exist_ok=True) (static_dir / "html").mkdir(exist_ok=True) # 掛載靜態文件 if (static_dir / "css").exists(): app.mount("/css", StaticFiles(directory=static_dir / "css"), name="css") if (static_dir / "js").exists(): app.mount("/js", StaticFiles(directory=static_dir / "js"), name="js") # 基本路由 @app.get("/") async def root(): return {"message": "醫院藥物管理系統API", "status": "running", "version": "1.0"} @app.get("/api/test") async def test_api(): return {"status": "success", "message": "API連接正常"} # 藥物管理API - 簡化版本 medicines_db = [] @app.get("/api/medicine/") async def get_medicines(): return medicines_db @app.post("/api/medicine/") async def create_medicine(medicine: dict): medicine["id"] = len(medicines_db) + 1 medicines_db.append(medicine) return medicine @app.get("/api/medicine/{medicine_id}") async def get_medicine(medicine_id: int): for medicine in medicines_db: if medicine.get("id") == medicine_id: return medicine raise HTTPException(status_code=404, detail="Medicine not found") @app.delete("/api/medicine/{medicine_id}") async def delete_medicine(medicine_id: int): global medicines_db medicines_db = [m for m in medicines_db if m.get("id") != medicine_id] return {"message": "Medicine deleted successfully"} # 服務HTML文件 @app.get("/Medicine.html") async def serve_medicine_html(): html_file = static_dir / "html" / "Medicine.html" if html_file.exists(): return FileResponse(html_file) else: return JSONResponse( content={"error": "Medicine.html not found"}, status_code=404 ) if __name__ == "__main__": import uvicorn print(" 啟動醫院藥物管理系統...") print(f"📁 靜態文件目錄: {static_dir}") print(" 伺服器將在 http://localhost:8000 啟動") print(" API文檔: http://localhost:8000/docs") print(" 藥物管理頁面: http://localhost:8000/Medicine.html") try: uvicorn.run( app, host="0.0.0.0", port=8000, log_level="info" ) except Exception as e: print(f" 錯誤: 伺服器啟動失敗: {e}") sys.exit(1)