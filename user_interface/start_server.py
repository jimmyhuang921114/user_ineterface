#!/usr/bin/env python3 """ é†«é™¢è—¥ç‰©ç®¡ç†ç³»çµ±ä¼ºæœå™¨å•Ÿå‹•è…³æœ¬ """ from fastapi import FastAPI, HTTPException from fastapi.middleware.cors import CORSMiddleware from fastapi.staticfiles import StaticFiles from fastapi.responses import JSONResponse, FileResponse from pathlib import Path import os import sys # æ·»åŠ ç•¶å‰ç›®éŒ„åˆ°Pythonè·¯å¾‘ sys.path.append(os.path.dirname(os.path.abspath(__file__))) app = FastAPI(title="é†«é™¢è—¥ç‰©ç®¡ç†ç³»çµ±") # CORSè¨­å®š app.add_middleware( CORSMiddleware, allow_origins=["*"], allow_credentials=True, allow_methods=["*"], allow_headers=["*"], ) # è¨­å®šéœæ…‹æ–‡ä»¶è·¯å¾‘ base_dir = Path(__file__).resolve().parent static_dir = base_dir / "static" # ç¢ºä¿éœæ…‹æ–‡ä»¶ç›®éŒ„å­˜åœ¨ static_dir.mkdir(exist_ok=True) (static_dir / "css").mkdir(exist_ok=True) (static_dir / "js").mkdir(exist_ok=True) (static_dir / "html").mkdir(exist_ok=True) # æ›è¼‰éœæ…‹æ–‡ä»¶ if (static_dir / "css").exists(): app.mount("/css", StaticFiles(directory=static_dir / "css"), name="css") if (static_dir / "js").exists(): app.mount("/js", StaticFiles(directory=static_dir / "js"), name="js") # åŸºæœ¬è·¯ç”± @app.get("/") async def root(): return {"message": "é†«é™¢è—¥ç‰©ç®¡ç†ç³»çµ±API", "status": "running", "version": "1.0"} @app.get("/api/test") async def test_api(): return {"status": "success", "message": "APIé€£æ¥æ­£å¸¸"} # è—¥ç‰©ç®¡ç†API - ç°¡åŒ–ç‰ˆæœ¬ medicines_db = [] @app.get("/api/medicine/") async def get_medicines(): return medicines_db @app.post("/api/medicine/") async def create_medicine(medicine: dict): medicine["id"] = len(medicines_db) + 1 medicines_db.append(medicine) return medicine @app.get("/api/medicine/{medicine_id}") async def get_medicine(medicine_id: int): for medicine in medicines_db: if medicine.get("id") == medicine_id: return medicine raise HTTPException(status_code=404, detail="Medicine not found") @app.delete("/api/medicine/{medicine_id}") async def delete_medicine(medicine_id: int): global medicines_db medicines_db = [m for m in medicines_db if m.get("id") != medicine_id] return {"message": "Medicine deleted successfully"} # æœå‹™HTMLæ–‡ä»¶ @app.get("/Medicine.html") async def serve_medicine_html(): html_file = static_dir / "html" / "Medicine.html" if html_file.exists(): return FileResponse(html_file) else: return JSONResponse( content={"error": "Medicine.html not found"}, status_code=404 ) if __name__ == "__main__": import uvicorn print(" å•Ÿå‹•é†«é™¢è—¥ç‰©ç®¡ç†ç³»çµ±...") print(f"ğŸ“ éœæ…‹æ–‡ä»¶ç›®éŒ„: {static_dir}") print(" ä¼ºæœå™¨å°‡åœ¨ http://localhost:8000 å•Ÿå‹•") print(" APIæ–‡æª”: http://localhost:8000/docs") print(" è—¥ç‰©ç®¡ç†é é¢: http://localhost:8000/Medicine.html") try: uvicorn.run( app, host="0.0.0.0", port=8000, log_level="info" ) except Exception as e: print(f" éŒ¯èª¤: ä¼ºæœå™¨å•Ÿå‹•å¤±æ•—: {e}") sys.exit(1)