<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§ª APIåŠŸèƒ½æ¸¬è©¦</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .test-section { 
            background: white; 
            margin: 20px 0; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section h2 { color: #333; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
        .button-group { margin: 15px 0; }
        .btn { 
            padding: 10px 20px; 
            margin: 5px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            font-size: 14px;
            transition: all 0.3s;
        }
        .btn-primary { background: #007bff; color: white; }
        .btn-primary:hover { background: #0056b3; transform: translateY(-1px); }
        .btn-success { background: #28a745; color: white; }
        .btn-success:hover { background: #1e7e34; transform: translateY(-1px); }
        .btn-info { background: #17a2b8; color: white; }
        .btn-info:hover { background: #138496; transform: translateY(-1px); }
        .result { 
            background: #f8f9fa; 
            border: 1px solid #dee2e6; 
            border-radius: 5px; 
            padding: 15px; 
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .status { display: inline-block; padding: 5px 10px; border-radius: 20px; font-size: 12px; margin-left: 10px; }
        .status-success { background: #d4edda; color: #155724; }
        .status-error { background: #f8d7da; color: #721c24; }
        .nav-links { text-align: center; margin: 20px 0; }
        .nav-links a { 
            display: inline-block; 
            margin: 0 10px; 
            padding: 10px 20px; 
            background: #6c757d; 
            color: white; 
            text-decoration: none; 
            border-radius: 5px;
            transition: background 0.3s;
        }
        .nav-links a:hover { background: #545b62; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª é†«é™¢è—¥ç‰©ç®¡ç†ç³»çµ± - APIåŠŸèƒ½æ¸¬è©¦</h1>
        
        <div class="nav-links">
            <a href="/doctor.html">ğŸ‘¨â€âš•ï¸ é†«ç”Ÿç•Œé¢</a>
            <a href="/medicine_integrated.html">ğŸ’Š æ•´åˆè—¥ç‰©ç®¡ç†</a>
            <a href="/Prescription.html">ğŸ“‹ è™•æ–¹ç±¤ç®¡ç†</a>
            <a href="/docs">ğŸ“– APIæ–‡æª”</a>
        </div>

        <!-- åŸºæœ¬è—¥ç‰©APIæ¸¬è©¦ -->
        <div class="test-section">
            <h2>ğŸ’Š åŸºæœ¬è—¥ç‰©APIæ¸¬è©¦</h2>
            <div class="button-group">
                <button class="btn btn-primary" onclick="testBasicMedicinesGet()">ğŸ“‹ ç²å–åŸºæœ¬è—¥ç‰©</button>
                <button class="btn btn-success" onclick="testBasicMedicinePost()">â• æ–°å¢åŸºæœ¬è—¥ç‰©</button>
                <button class="btn btn-info" onclick="testROS2BasicMedicines()">ğŸ¤– ROS2ç²å–åŸºæœ¬è—¥ç‰©</button>
            </div>
            <div id="basicMedicineResult" class="result" style="display: none;"></div>
        </div>

        <!-- è©³ç´°è—¥ç‰©APIæ¸¬è©¦ -->
        <div class="test-section">
            <h2>ğŸ“Š è©³ç´°è—¥ç‰©APIæ¸¬è©¦</h2>
            <div class="button-group">
                <button class="btn btn-primary" onclick="testDetailedMedicinesGet()">ğŸ“‹ ç²å–è©³ç´°è—¥ç‰©</button>
                <button class="btn btn-success" onclick="testDetailedMedicinePost()">â• æ–°å¢è©³ç´°è—¥ç‰©</button>
                <button class="btn btn-info" onclick="testROS2DetailedMedicines()">ğŸ¤– ROS2ç²å–è©³ç´°è—¥ç‰©</button>
            </div>
            <div id="detailedMedicineResult" class="result" style="display: none;"></div>
        </div>

        <!-- è™•æ–¹ç±¤APIæ¸¬è©¦ -->
        <div class="test-section">
            <h2>ğŸ“‹ è™•æ–¹ç±¤APIæ¸¬è©¦</h2>
            <div class="button-group">
                <button class="btn btn-primary" onclick="testPrescriptionsGet()">ğŸ“‹ ç²å–è™•æ–¹ç±¤</button>
                <button class="btn btn-success" onclick="testPrescriptionPost()">â• æ–°å¢è™•æ–¹ç±¤</button>
                <button class="btn btn-info" onclick="testROS2Prescriptions()">ğŸ¤– ROS2ç²å–è™•æ–¹ç±¤</button>
            </div>
            <div id="prescriptionResult" class="result" style="display: none;"></div>
        </div>

        <!-- æ•´åˆAPIæ¸¬è©¦ -->
        <div class="test-section">
            <h2>ğŸ”— æ•´åˆAPIæ¸¬è©¦</h2>
            <div class="button-group">
                <button class="btn btn-info" onclick="testROS2IntegratedMedicine()">ğŸ¤– ROS2ç²å–æ•´åˆè—¥ç‰©</button>
                <button class="btn btn-primary" onclick="testAllAPIs()">ğŸš€ æ¸¬è©¦æ‰€æœ‰API</button>
                <button class="btn btn-success" onclick="clearAllResults()">ğŸ—‘ï¸ æ¸…ç©ºçµæœ</button>
            </div>
            <div id="integratedResult" class="result" style="display: none;"></div>
        </div>

        <!-- æ•´é«”æ¸¬è©¦çµæœ -->
        <div class="test-section">
            <h2>ğŸ“Š æ•´é«”æ¸¬è©¦çµæœ</h2>
            <div id="overallResult" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';

        function showResult(elementId, content, success = true) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.textContent = JSON.stringify(content, null, 2);
            element.style.background = success ? '#d4edda' : '#f8d7da';
        }

        function showError(elementId, error) {
            showResult(elementId, { error: error.message || error }, false);
        }

        // åŸºæœ¬è—¥ç‰©APIæ¸¬è©¦
        async function testBasicMedicinesGet() {
            try {
                const response = await fetch(`${API_BASE}/api/medicine/basic`);
                const data = await response.json();
                showResult('basicMedicineResult', data, response.ok);
            } catch (error) {
                showError('basicMedicineResult', error);
            }
        }

        async function testBasicMedicinePost() {
            try {
                const testData = {
                    name: "æ¸¬è©¦è—¥ç‰©_" + Date.now(),
                    amount: 50,
                    usage_days: 7,
                    position: "TEST-A1",
                    manufacturer: "æ¸¬è©¦è£½è—¥å…¬å¸",
                    dosage: "100mg"
                };
                
                const response = await fetch(`${API_BASE}/api/medicine/basic`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testData)
                });
                
                const data = await response.json();
                showResult('basicMedicineResult', data, response.ok);
            } catch (error) {
                showError('basicMedicineResult', error);
            }
        }

        async function testROS2BasicMedicines() {
            try {
                const response = await fetch(`${API_BASE}/api/ros2/medicine/basic`);
                const data = await response.json();
                showResult('basicMedicineResult', data, response.ok);
            } catch (error) {
                showError('basicMedicineResult', error);
            }
        }

        // è©³ç´°è—¥ç‰©APIæ¸¬è©¦
        async function testDetailedMedicinesGet() {
            try {
                const response = await fetch(`${API_BASE}/api/medicine/detailed`);
                const data = await response.json();
                showResult('detailedMedicineResult', data, response.ok);
            } catch (error) {
                showError('detailedMedicineResult', error);
            }
        }

        async function testDetailedMedicinePost() {
            try {
                const testData = {
                    medicine_name: "æ¸¬è©¦è—¥ç‰©_" + Date.now(),
                    description: "é€™æ˜¯ä¸€å€‹æ¸¬è©¦ç”¨çš„è—¥ç‰©æè¿°",
                    side_effects: "å¯èƒ½çš„å‰¯ä½œç”¨åŒ…æ‹¬é ­æšˆ",
                    appearance: {
                        color: "ç™½è‰²",
                        shape: "åœ“å½¢"
                    },
                    storage_conditions: "å®¤æº«ä¿å­˜",
                    expiry_date: "2025-12-31",
                    notes: "æ¸¬è©¦ç”¨è—¥ç‰©ï¼Œè«‹å‹¿å¯¦éš›ä½¿ç”¨"
                };
                
                const response = await fetch(`${API_BASE}/api/medicine/detailed`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testData)
                });
                
                const data = await response.json();
                showResult('detailedMedicineResult', data, response.ok);
            } catch (error) {
                showError('detailedMedicineResult', error);
            }
        }

        async function testROS2DetailedMedicines() {
            try {
                const response = await fetch(`${API_BASE}/api/ros2/medicine/detailed`);
                const data = await response.json();
                showResult('detailedMedicineResult', data, response.ok);
            } catch (error) {
                showError('detailedMedicineResult', error);
            }
        }

        // è™•æ–¹ç±¤APIæ¸¬è©¦
        async function testPrescriptionsGet() {
            try {
                const response = await fetch(`${API_BASE}/api/prescription/`);
                const data = await response.json();
                showResult('prescriptionResult', data, response.ok);
            } catch (error) {
                showError('prescriptionResult', error);
            }
        }

        async function testPrescriptionPost() {
            try {
                const testData = {
                    patient_name: "æ¸¬è©¦æ‚£è€…_" + Date.now(),
                    doctor_name: "æ¸¬è©¦é†«å¸«",
                    diagnosis: "æ¸¬è©¦è¨ºæ–·",
                    medicines: [{
                        medicine_name: "æ¸¬è©¦è—¥ç‰©",
                        dosage: "100mg",
                        frequency: "æ¯æ—¥ä¸‰æ¬¡",
                        duration: "7å¤©",
                        instructions: "é£¯å¾Œæœç”¨"
                    }],
                    prescription_date: new Date().toISOString().split('T')[0]
                };
                
                const response = await fetch(`${API_BASE}/api/prescription/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testData)
                });
                
                const data = await response.json();
                showResult('prescriptionResult', data, response.ok);
            } catch (error) {
                showError('prescriptionResult', error);
            }
        }

        async function testROS2Prescriptions() {
            try {
                const response = await fetch(`${API_BASE}/api/ros2/prescription`);
                const data = await response.json();
                showResult('prescriptionResult', data, response.ok);
            } catch (error) {
                showError('prescriptionResult', error);
            }
        }

        // æ•´åˆAPIæ¸¬è©¦
        async function testROS2IntegratedMedicine() {
            try {
                const medicineName = "æ¸¬è©¦è—¥ç‰©_" + Date.now();
                const response = await fetch(`${API_BASE}/api/ros2/medicine/integrated/${medicineName}`);
                const data = await response.json();
                showResult('integratedResult', data, response.ok);
            } catch (error) {
                showError('integratedResult', error);
            }
        }

        // æ¸¬è©¦æ‰€æœ‰API
        async function testAllAPIs() {
            const results = [];
            const tests = [
                { name: 'åŸºæœ¬è—¥ç‰©GET', func: testBasicMedicinesGet },
                { name: 'è©³ç´°è—¥ç‰©GET', func: testDetailedMedicinesGet },
                { name: 'è™•æ–¹ç±¤GET', func: testPrescriptionsGet },
                { name: 'ROS2åŸºæœ¬è—¥ç‰©', func: testROS2BasicMedicines },
                { name: 'ROS2è©³ç´°è—¥ç‰©', func: testROS2DetailedMedicines },
                { name: 'ROS2è™•æ–¹ç±¤', func: testROS2Prescriptions }
            ];

            for (const test of tests) {
                try {
                    await test.func();
                    results.push(`âœ… ${test.name}: æˆåŠŸ`);
                } catch (error) {
                    results.push(`âŒ ${test.name}: å¤±æ•— - ${error.message}`);
                }
                await new Promise(resolve => setTimeout(resolve, 500)); // å»¶é²500ms
            }

            showResult('overallResult', {
                message: 'æ‰€æœ‰APIæ¸¬è©¦å®Œæˆ',
                results: results,
                timestamp: new Date().toISOString()
            });
        }

        // æ¸…ç©ºæ‰€æœ‰çµæœ
        function clearAllResults() {
            ['basicMedicineResult', 'detailedMedicineResult', 'prescriptionResult', 'integratedResult', 'overallResult'].forEach(id => {
                const element = document.getElementById(id);
                element.style.display = 'none';
                element.textContent = '';
            });
        }

        // é é¢è¼‰å…¥æ™‚é¡¯ç¤ºæ­¡è¿è¨Šæ¯
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ§ª APIæ¸¬è©¦é é¢å·²è¼‰å…¥');
            showResult('overallResult', {
                message: 'æ­¡è¿ä½¿ç”¨APIæ¸¬è©¦å·¥å…·',
                available_endpoints: [
                    'GET /api/medicine/basic - ç²å–åŸºæœ¬è—¥ç‰©',
                    'POST /api/medicine/basic - æ–°å¢åŸºæœ¬è—¥ç‰©',
                    'GET /api/medicine/detailed - ç²å–è©³ç´°è—¥ç‰©',
                    'POST /api/medicine/detailed - æ–°å¢è©³ç´°è—¥ç‰©',
                    'GET /api/prescription/ - ç²å–è™•æ–¹ç±¤',
                    'POST /api/prescription/ - æ–°å¢è™•æ–¹ç±¤',
                    'GET /api/ros2/medicine/basic - ROS2ç²å–åŸºæœ¬è—¥ç‰©',
                    'GET /api/ros2/medicine/detailed - ROS2ç²å–è©³ç´°è—¥ç‰©',
                    'GET /api/ros2/prescription - ROS2ç²å–è™•æ–¹ç±¤',
                    'GET /api/ros2/medicine/integrated/{name} - ROS2ç²å–æ•´åˆè—¥ç‰©'
                ],
                timestamp: new Date().toISOString()
            });
        });
    </script>
</body>
</html>