<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ©º ç°¡åŒ–åŠŸèƒ½æ¸¬è©¦</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        button { margin: 5px; padding: 10px 15px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 3px; font-family: monospace; }
        input, select { margin: 5px; padding: 8px; border: 1px solid #ddd; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>ğŸ©º é†«é™¢ç®¡ç†ç³»çµ± - ç°¡åŒ–åŠŸèƒ½æ¸¬è©¦</h1>

    <!-- API é€£æ¥æ¸¬è©¦ -->
    <div class="section">
        <h2>ğŸ“¡ API é€£æ¥æ¸¬è©¦</h2>
        <button onclick="testAPIConnection()">æ¸¬è©¦ API é€£æ¥</button>
        <div id="apiResult" class="result"></div>
    </div>

    <!-- è—¥ç‰©ç®¡ç†æ¸¬è©¦ -->
    <div class="section">
        <h2>ğŸ’Š è—¥ç‰©ç®¡ç†æ¸¬è©¦</h2>
        <div>
            <input type="text" id="medicineName" placeholder="è—¥ç‰©åç¨±" value="æ¸¬è©¦è—¥ç‰©">
            <input type="number" id="medicineAmount" placeholder="æ•¸é‡" value="100">
            <input type="number" id="medicineUsageDays" placeholder="ä½¿ç”¨å¤©æ•¸" value="7">
            <input type="text" id="medicinePosition" placeholder="å„²å­˜ä½ç½®" value="A1-01">
        </div>
        <button onclick="addMedicine()">æ–°å¢è—¥ç‰©</button>
        <button onclick="getMedicines()">ç²å–è—¥ç‰©åˆ—è¡¨</button>
        <div id="medicineResult" class="result"></div>
    </div>

    <!-- è™•æ–¹ç±¤ç®¡ç†æ¸¬è©¦ -->
    <div class="section">
        <h2>ğŸ“‹ è™•æ–¹ç±¤ç®¡ç†æ¸¬è©¦</h2>
        <div>
            <input type="text" id="patientName" placeholder="æ‚£è€…å§“å" value="ç‹å°æ˜">
            <input type="text" id="doctorName" placeholder="é†«ç”Ÿå§“å" value="æé†«å¸«">
            <input type="text" id="diagnosis" placeholder="è¨ºæ–·çµæœ" value="æ„Ÿå†’">
        </div>
        <button onclick="addPrescription()">é–‹ç«‹è™•æ–¹ç±¤</button>
        <button onclick="getPrescriptions()">ç²å–è™•æ–¹ç±¤åˆ—è¡¨</button>
        <div id="prescriptionResult" class="result"></div>
    </div>

    <!-- æ¨™ç±¤é åˆ‡æ›æ¸¬è©¦ -->
    <div class="section">
        <h2>ğŸ”„ æ¨™ç±¤é åˆ‡æ›æ¸¬è©¦</h2>
        <div class="tab-buttons">
            <button class="tab-button active" onclick="switchTestTab('test1')">æ¸¬è©¦é é¢1</button>
            <button class="tab-button" onclick="switchTestTab('test2')">æ¸¬è©¦é é¢2</button>
            <button class="tab-button" onclick="switchTestTab('test3')">æ¸¬è©¦é é¢3</button>
        </div>
        <div id="test1" class="tab-content active" style="display: block; padding: 10px; border: 1px solid #ddd; margin-top: 10px;">
            é€™æ˜¯æ¸¬è©¦é é¢1çš„å…§å®¹
        </div>
        <div id="test2" class="tab-content" style="display: none; padding: 10px; border: 1px solid #ddd; margin-top: 10px;">
            é€™æ˜¯æ¸¬è©¦é é¢2çš„å…§å®¹
        </div>
        <div id="test3" class="tab-content" style="display: none; padding: 10px; border: 1px solid #ddd; margin-top: 10px;">
            é€™æ˜¯æ¸¬è©¦é é¢3çš„å…§å®¹
        </div>
        <div id="tabResult" class="result"></div>
    </div>

    <!-- ç¶œåˆæ¸¬è©¦ -->
    <div class="section">
        <h2>ğŸ¯ ç¶œåˆæ¸¬è©¦</h2>
        <button onclick="runAllTests()">åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦</button>
        <button onclick="clearAllResults()">æ¸…ç©ºçµæœ</button>
        <div id="allTestResult" class="result"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api';

        // API é€£æ¥æ¸¬è©¦
        async function testAPIConnection() {
            const result = document.getElementById('apiResult');
            try {
                const response = await fetch(`${API_BASE}/medicine/`);
                if (response.ok) {
                    result.innerHTML = 'âœ… API é€£æ¥æˆåŠŸ - ç‹€æ…‹: ' + response.status;
                    result.style.background = '#d4edda';
                } else {
                    result.innerHTML = 'âŒ API é€£æ¥å¤±æ•— - ç‹€æ…‹: ' + response.status;
                    result.style.background = '#f8d7da';
                }
            } catch (error) {
                result.innerHTML = 'âŒ API é€£æ¥éŒ¯èª¤: ' + error.message;
                result.style.background = '#f8d7da';
            }
        }

        // æ–°å¢è—¥ç‰©
        async function addMedicine() {
            const result = document.getElementById('medicineResult');
            try {
                const data = {
                    name: document.getElementById('medicineName').value,
                    amount: parseInt(document.getElementById('medicineAmount').value),
                    usage_days: parseInt(document.getElementById('medicineUsageDays').value),
                    position: document.getElementById('medicinePosition').value
                };

                const response = await fetch(`${API_BASE}/medicine/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    const medicine = await response.json();
                    result.innerHTML = 'âœ… è—¥ç‰©æ–°å¢æˆåŠŸ: ' + JSON.stringify(medicine, null, 2);
                    result.style.background = '#d4edda';
                } else {
                    result.innerHTML = 'âŒ è—¥ç‰©æ–°å¢å¤±æ•— - ç‹€æ…‹: ' + response.status;
                    result.style.background = '#f8d7da';
                }
            } catch (error) {
                result.innerHTML = 'âŒ è—¥ç‰©æ–°å¢éŒ¯èª¤: ' + error.message;
                result.style.background = '#f8d7da';
            }
        }

        // ç²å–è—¥ç‰©åˆ—è¡¨
        async function getMedicines() {
            const result = document.getElementById('medicineResult');
            try {
                const response = await fetch(`${API_BASE}/medicine/`);
                if (response.ok) {
                    const medicines = await response.json();
                    result.innerHTML = 'âœ… è—¥ç‰©åˆ—è¡¨ç²å–æˆåŠŸ:\n' + JSON.stringify(medicines, null, 2);
                    result.style.background = '#d4edda';
                } else {
                    result.innerHTML = 'âŒ è—¥ç‰©åˆ—è¡¨ç²å–å¤±æ•— - ç‹€æ…‹: ' + response.status;
                    result.style.background = '#f8d7da';
                }
            } catch (error) {
                result.innerHTML = 'âŒ è—¥ç‰©åˆ—è¡¨ç²å–éŒ¯èª¤: ' + error.message;
                result.style.background = '#f8d7da';
            }
        }

        // é–‹ç«‹è™•æ–¹ç±¤
        async function addPrescription() {
            const result = document.getElementById('prescriptionResult');
            try {
                const data = {
                    patient_name: document.getElementById('patientName').value,
                    doctor_name: document.getElementById('doctorName').value,
                    diagnosis: document.getElementById('diagnosis').value,
                    medicines: [{
                        medicine_name: 'æ¸¬è©¦è—¥ç‰©',
                        dosage: '100mg',
                        frequency: 'æ¯æ—¥ä¸‰æ¬¡',
                        duration: '7å¤©',
                        instructions: 'é£¯å¾Œæœç”¨'
                    }],
                    prescription_date: new Date().toISOString().split('T')[0]
                };

                const response = await fetch(`${API_BASE}/prescription/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    const prescription = await response.json();
                    result.innerHTML = 'âœ… è™•æ–¹ç±¤é–‹ç«‹æˆåŠŸ: ' + JSON.stringify(prescription, null, 2);
                    result.style.background = '#d4edda';
                } else {
                    result.innerHTML = 'âŒ è™•æ–¹ç±¤é–‹ç«‹å¤±æ•— - ç‹€æ…‹: ' + response.status;
                    result.style.background = '#f8d7da';
                }
            } catch (error) {
                result.innerHTML = 'âŒ è™•æ–¹ç±¤é–‹ç«‹éŒ¯èª¤: ' + error.message;
                result.style.background = '#f8d7da';
            }
        }

        // ç²å–è™•æ–¹ç±¤åˆ—è¡¨
        async function getPrescriptions() {
            const result = document.getElementById('prescriptionResult');
            try {
                const response = await fetch(`${API_BASE}/prescription/`);
                if (response.ok) {
                    const prescriptions = await response.json();
                    result.innerHTML = 'âœ… è™•æ–¹ç±¤åˆ—è¡¨ç²å–æˆåŠŸ:\n' + JSON.stringify(prescriptions, null, 2);
                    result.style.background = '#d4edda';
                } else {
                    result.innerHTML = 'âŒ è™•æ–¹ç±¤åˆ—è¡¨ç²å–å¤±æ•— - ç‹€æ…‹: ' + response.status;
                    result.style.background = '#f8d7da';
                }
            } catch (error) {
                result.innerHTML = 'âŒ è™•æ–¹ç±¤åˆ—è¡¨ç²å–éŒ¯èª¤: ' + error.message;
                result.style.background = '#f8d7da';
            }
        }

        // æ¨™ç±¤é åˆ‡æ›æ¸¬è©¦
        function switchTestTab(tabName) {
            const result = document.getElementById('tabResult');
            
            // éš±è—æ‰€æœ‰æ¨™ç±¤é å…§å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'none';
                content.classList.remove('active');
            });

            // ç§»é™¤æ‰€æœ‰æŒ‰éˆ•çš„ active ç‹€æ…‹
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });

            // é¡¯ç¤ºé¸ä¸­çš„æ¨™ç±¤é 
            const targetTab = document.getElementById(tabName);
            if (targetTab) {
                targetTab.style.display = 'block';
                targetTab.classList.add('active');
                result.innerHTML = 'âœ… æˆåŠŸåˆ‡æ›åˆ°: ' + tabName;
                result.style.background = '#d4edda';
            } else {
                result.innerHTML = 'âŒ æ‰¾ä¸åˆ°æ¨™ç±¤é : ' + tabName;
                result.style.background = '#f8d7da';
            }
            
            // è¨­ç½®æŒ‰éˆ•ç‚º active ç‹€æ…‹
            if (event && event.target) {
                event.target.classList.add('active');
            }
        }

        // åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
        async function runAllTests() {
            const result = document.getElementById('allTestResult');
            result.innerHTML = 'ğŸš€ é–‹å§‹åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦...\n';
            result.style.background = '#d1ecf1';

            await testAPIConnection();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await addMedicine();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await getMedicines();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await addPrescription();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await getPrescriptions();
            
            result.innerHTML += '\nğŸ‰ æ‰€æœ‰æ¸¬è©¦åŸ·è¡Œå®Œæˆï¼';
        }

        // æ¸…ç©ºæ‰€æœ‰çµæœ
        function clearAllResults() {
            document.querySelectorAll('.result').forEach(result => {
                result.innerHTML = '';
                result.style.background = '#f8f9fa';
            });
        }

        // é é¢è¼‰å…¥æ™‚æ¸¬è©¦ API é€£æ¥
        document.addEventListener('DOMContentLoaded', () => {
            testAPIConnection();
        });
    </script>
</body>
</html>