nohup: ignoring input
2025-08-06 17:43:40,099 - hospital_system - INFO - 📊 資料庫已有 16 種藥物，跳過樣本資料初始化
2025-08-06 17:43:40,099 - ros2_mock - INFO - 🚀 啟動模擬ROS2整合...
2025-08-06 17:43:40,099 - ros2_mock - INFO - 🤖 初始化模擬ROS2節點...
2025-08-06 17:43:40,099 - ros2_mock - INFO - ✅ 模擬ROS2節點初始化完成
2025-08-06 17:43:40,100 - ros2_mock - INFO - ✅ 模擬ROS2整合啟動成功
2025-08-06 17:43:40,120 - asyncio - DEBUG - Using selector: EpollSelector
INFO:     Started server process [15678]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8001 (Press CTRL+C to quit)
2025-08-06 17:43:48,694 - hospital_system - INFO - 🔍 查找下一個待處理的處方籤
🤖 使用模擬ROS2模式
✅ 資料庫表格創建完成
🏥 簡化醫院藥物管理系統
==================================================
🌐 整合管理: http://localhost:8001/integrated_medicine_management.html
📋 處方籤管理: http://localhost:8001/Prescription.html
👨‍⚕️ 醫生界面: http://localhost:8001/doctor.html
📖 API文檔: http://localhost:8001/docs
🤖 ROS2狀態: 模擬模式
==================================================
INFO:     127.0.0.1:46590 - "GET /api/prescription/pending/next HTTP/1.1" 200 OK
2025-08-06 17:43:50,468 - hospital_system - INFO - 💓 系統健康檢查請求
2025-08-06 17:43:50,468 - hospital_system - INFO - 💓 健康檢查結果: {'status': 'healthy', 'message': '系統運行正常', 'ros2_status': 'mock', 'ros2_mode': 'mock'}
INFO:     127.0.0.1:46596 - "GET /api/health HTTP/1.1" 200 OK
2025-08-06 17:44:02,198 - hospital_system - INFO - 🤖 ROS2 主控制器請求下一個訂單
2025-08-06 17:44:02,199 - hospital_system - INFO - 📦 沒有待處理的處方籤
INFO:     127.0.0.1:46312 - "POST /api/ros2/request-next-order HTTP/1.1" 200 OK
2025-08-06 17:44:14,287 - hospital_system - INFO - 📋 開始創建新處方籤
2025-08-06 17:44:14,287 - hospital_system - DEBUG - 📋 接收到的處方數據: {'patient_name': 'ROS2測試病患', 'patient_id': 'P123456789', 'doctor_name': 'ROS2測試醫生', 'diagnosis': 'ROS2測試診斷', 'medicines': [['普拿疼', '500mg', '30', '每日三次'], ['阿斯匹靈', '100mg', '20', '每日兩次'], ['維他命C', '500mg', '60', '每日一次']]}
2025-08-06 17:44:14,287 - hospital_system - INFO - 💊 處方包含 3 種藥物
2025-08-06 17:44:14,292 - hospital_system - INFO - ✅ 處方籤基本資料已創建，ID: 25
2025-08-06 17:44:14,292 - hospital_system - DEBUG - 💊 處理第 1 個藥物: ['普拿疼', '500mg', '30', '每日三次']
2025-08-06 17:44:14,292 - hospital_system - DEBUG - 💊 藥物詳情 - 名稱: 普拿疼, 劑量: 500mg, 數量: 30, 頻率: 每日三次
2025-08-06 17:44:14,293 - hospital_system - DEBUG - ✅ 藥物 普拿疼 已加入處方籤
2025-08-06 17:44:14,294 - hospital_system - DEBUG - 💊 處理第 2 個藥物: ['阿斯匹靈', '100mg', '20', '每日兩次']
2025-08-06 17:44:14,294 - hospital_system - DEBUG - 💊 藥物詳情 - 名稱: 阿斯匹靈, 劑量: 100mg, 數量: 20, 頻率: 每日兩次
2025-08-06 17:44:14,294 - hospital_system - DEBUG - ✅ 藥物 阿斯匹靈 已加入處方籤
2025-08-06 17:44:14,294 - hospital_system - DEBUG - 💊 處理第 3 個藥物: ['維他命C', '500mg', '60', '每日一次']
2025-08-06 17:44:14,294 - hospital_system - DEBUG - 💊 藥物詳情 - 名稱: 維他命C, 劑量: 500mg, 數量: 60, 頻率: 每日一次
2025-08-06 17:44:14,294 - hospital_system - WARNING - ⚠️ 找不到藥物: 維他命C
2025-08-06 17:44:14,298 - hospital_system - INFO - ✅ 處方籤創建完成，共添加 2 種藥物
2025-08-06 17:44:14,299 - hospital_system - INFO - 📡 ROS2可用，準備創建訂單
2025-08-06 17:44:14,299 - ros2_mock - INFO - 📦 訂單已加入佇列: ORDER_0025
2025-08-06 17:44:14,299 - ros2_mock - DEBUG - 📦 訂單詳情: {
  "order_id": "ORDER_0025",
  "prescription_id": 25,
  "patient_name": "ROS2測試病患",
  "patient_id": "P123456789",
  "doctor_name": "ROS2測試醫生",
  "diagnosis": "ROS2測試診斷",
  "status": "queued",
  "created_at": "2025-08-06 17:44:14",
  "timestamp": 1754502254.2993507,
  "priority": "normal"
}
2025-08-06 17:44:14,299 - ros2_mock - INFO - 📡 向 ROS2 主控制器傳送訂單: ORDER_0025
2025-08-06 17:44:14,299 - ros2_mock - DEBUG - 📡 傳送的訊息: {
  "message_type": "new_prescription_order",
  "order_id": "ORDER_0025",
  "prescription_id": 25,
  "patient_info": {
    "name": "ROS2測試病患",
    "id": "P123456789"
  },
  "medicines": [],
  "priority": "normal",
  "timestamp": 1754502254.2993507,
  "estimated_completion_time": 1754502554.2995415
}
2025-08-06 17:44:14,299 - hospital_system - INFO - 📡 ROS2訂單已創建: ORDER_0025
INFO:     127.0.0.1:42256 - "POST /api/prescription/ HTTP/1.1" 200 OK
2025-08-06 17:44:15,104 - ros2_mock - INFO - 🤖 開始處理訂單: ORDER_0025
2025-08-06 17:44:15,104 - ros2_mock - INFO - 🤖 驗證處方籤中...
2025-08-06 17:44:17,104 - ros2_mock - INFO - 🤖 定位藥物中...
2025-08-06 17:44:20,104 - ros2_mock - INFO - 🤖 移動機器人中...
2025-08-06 17:44:24,105 - ros2_mock - INFO - 🤖 分配藥物中...
2025-08-06 17:44:24,296 - hospital_system - INFO - 📋 獲取處方籤列表
2025-08-06 17:44:24,306 - hospital_system - INFO - ✅ 返回 25 張處方籤
INFO:     127.0.0.1:35576 - "GET /api/prescription/ HTTP/1.1" 200 OK
2025-08-06 17:44:29,105 - ros2_mock - INFO - 🤖 包裝藥物中...
2025-08-06 17:44:32,105 - ros2_mock - INFO - 🤖 品質檢查中...
2025-08-06 17:44:32,496 - hospital_system - INFO - 🔄 更新處方籤 25 狀態
2025-08-06 17:44:32,500 - hospital_system - INFO - ✅ 處方籤 25 狀態已更新: active → pending
INFO:     127.0.0.1:42386 - "PUT /api/prescription/25/status HTTP/1.1" 200 OK
2025-08-06 17:44:34,106 - ros2_mock - INFO - ✅ 訂單處理完成
2025-08-06 17:44:44,659 - hospital_system - INFO - 🤖 ROS2 主控制器請求下一個訂單
2025-08-06 17:44:44,668 - hospital_system - INFO - 📦 分配訂單給 ROS2 主控制器: ORDER_0025 (處方籤 25)
2025-08-06 17:44:44,668 - hospital_system - INFO - 📦 包含 2 種藥物
INFO:     127.0.0.1:37870 - "POST /api/ros2/request-next-order HTTP/1.1" 200 OK
2025-08-06 18:59:48,168 - hospital_system - INFO - 💓 系統健康檢查請求
2025-08-06 18:59:48,169 - hospital_system - INFO - 💓 健康檢查結果: {'status': 'healthy', 'message': '系統運行正常', 'ros2_status': 'mock', 'ros2_mode': 'mock'}
INFO:     127.0.0.1:59168 - "GET /api/health HTTP/1.1" 200 OK
2025-08-06 18:59:57,457 - hospital_system - INFO - 🔍 開始獲取基本藥物列表
2025-08-06 18:59:57,473 - hospital_system - DEBUG - 📊 資料庫查詢結果: 找到 16 種藥物
2025-08-06 18:59:57,473 - hospital_system - INFO - ✅ 基本藥物列表構建完成，共 16 種藥物
2025-08-06 18:59:57,473 - hospital_system - DEBUG - 📡 ROS2可用，準備發布藥物資料
2025-08-06 18:59:57,473 - ros2_mock - DEBUG - 📡 發布藥物資料: 普拿疼
2025-08-06 18:59:57,473 - ros2_mock - DEBUG - 📡 發布藥物資料: 阿斯匹靈
2025-08-06 18:59:57,473 - ros2_mock - DEBUG - 📡 發布藥物資料: ROS2測試藥物
2025-08-06 18:59:57,473 - ros2_mock - DEBUG - 📡 發布藥物資料: 最終測試藥物
2025-08-06 18:59:57,473 - ros2_mock - DEBUG - 📡 發布藥物資料: 統一測試藥物
2025-08-06 18:59:57,473 - ros2_mock - DEBUG - 📡 發布藥物資料: 測試藥物
2025-08-06 18:59:57,473 - ros2_mock - DEBUG - 📡 發布藥物資料: 測試統一藥物
2025-08-06 18:59:57,473 - ros2_mock - DEBUG - 📡 發布藥物資料: 修復測試藥物
2025-08-06 18:59:57,473 - ros2_mock - DEBUG - 📡 發布藥物資料: 整合測試藥物
2025-08-06 18:59:57,473 - ros2_mock - DEBUG - 📡 發布藥物資料: 整合測試藥物2
2025-08-06 18:59:57,473 - ros2_mock - DEBUG - 📡 發布藥物資料: 最終整合測試藥物
2025-08-06 18:59:57,473 - ros2_mock - DEBUG - 📡 發布藥物資料: 簡化測試藥物
2025-08-06 18:59:57,473 - ros2_mock - DEBUG - 📡 發布藥物資料: 簡化測試藥物2
2025-08-06 18:59:57,473 - ros2_mock - DEBUG - 📡 發布藥物資料: 測試寫入藥物
2025-08-06 18:59:57,473 - ros2_mock - DEBUG - 📡 發布藥物資料: 測試寫入藥物2
2025-08-06 18:59:57,473 - ros2_mock - DEBUG - 📡 發布藥物資料: 庫存測試藥物
2025-08-06 18:59:57,473 - hospital_system - INFO - 📡 藥物資料已發布到ROS2
INFO:     127.0.0.1:43166 - "GET /api/medicine/basic HTTP/1.1" 200 OK
2025-08-06 19:01:34,291 - hospital_system - INFO - 🔍 開始獲取基本藥物列表
2025-08-06 19:01:34,294 - hospital_system - DEBUG - 📊 資料庫查詢結果: 找到 16 種藥物
2025-08-06 19:01:34,294 - hospital_system - INFO - ✅ 基本藥物列表構建完成，共 16 種藥物
2025-08-06 19:01:34,294 - hospital_system - DEBUG - 📡 ROS2可用，準備發布藥物資料
2025-08-06 19:01:34,294 - ros2_mock - DEBUG - 📡 發布藥物資料: 普拿疼
2025-08-06 19:01:34,294 - ros2_mock - DEBUG - 📡 發布藥物資料: 阿斯匹靈
2025-08-06 19:01:34,294 - ros2_mock - DEBUG - 📡 發布藥物資料: ROS2測試藥物
2025-08-06 19:01:34,294 - ros2_mock - DEBUG - 📡 發布藥物資料: 最終測試藥物
2025-08-06 19:01:34,294 - ros2_mock - DEBUG - 📡 發布藥物資料: 統一測試藥物
2025-08-06 19:01:34,295 - ros2_mock - DEBUG - 📡 發布藥物資料: 測試藥物
2025-08-06 19:01:34,295 - ros2_mock - DEBUG - 📡 發布藥物資料: 測試統一藥物
2025-08-06 19:01:34,295 - ros2_mock - DEBUG - 📡 發布藥物資料: 修復測試藥物
2025-08-06 19:01:34,295 - ros2_mock - DEBUG - 📡 發布藥物資料: 整合測試藥物
2025-08-06 19:01:34,295 - ros2_mock - DEBUG - 📡 發布藥物資料: 整合測試藥物2
2025-08-06 19:01:34,295 - ros2_mock - DEBUG - 📡 發布藥物資料: 最終整合測試藥物
2025-08-06 19:01:34,295 - ros2_mock - DEBUG - 📡 發布藥物資料: 簡化測試藥物
2025-08-06 19:01:34,295 - ros2_mock - DEBUG - 📡 發布藥物資料: 簡化測試藥物2
2025-08-06 19:01:34,295 - ros2_mock - DEBUG - 📡 發布藥物資料: 測試寫入藥物
2025-08-06 19:01:34,295 - ros2_mock - DEBUG - 📡 發布藥物資料: 測試寫入藥物2
2025-08-06 19:01:34,295 - ros2_mock - DEBUG - 📡 發布藥物資料: 庫存測試藥物
2025-08-06 19:01:34,295 - hospital_system - INFO - 📡 藥物資料已發布到ROS2
INFO:     127.0.0.1:51262 - "GET /api/medicine/basic HTTP/1.1" 200 OK
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [15678]
