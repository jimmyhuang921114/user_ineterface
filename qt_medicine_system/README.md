# 🏥 Qt藥物管理系統

一個整合Qt GUI、YAML資料儲存和ROS2通訊的完整藥物管理解決方案。

## ✨ 功能特色

### 🖥️ 圖形化使用者介面
- **現代化Qt6介面**: 使用PyQt6構建的直觀使用者介面
- **多標籤頁設計**: 藥物管理、處方籤管理、庫存管理、ROS2通訊、系統設定
- **即時搜尋和篩選**: 快速找到需要的藥物和處方籤
- **狀態顏色標示**: 直觀顯示藥物庫存狀態和處方籤處理狀態

### 💾 YAML資料儲存
- **結構化資料**: 使用YAML格式儲存藥物和處方籤資訊
- **自動備份**: 定期自動備份重要資料
- **資料匯入/匯出**: 支援多種格式的資料交換
- **版本控制**: 完整的資料變更歷史記錄

### 🤖 ROS2整合通訊
- **串行訂單處理**: 一次處理一筆訂單，確保完整性和一致性
- **藥物資訊服務**: 完整的CRUD操作支援
- **即時狀態同步**: 與其他ROS2節點即時通訊
- **錯誤處理**: 完善的錯誤處理和恢復機制

## 🚀 快速開始

### 環境需求
- Python 3.8+
- ROS2 Humble (可選)
- Qt6

### 安裝步驟

1. **克隆專案**
```bash
git clone <repository-url>
cd qt_medicine_system
```

2. **安裝依賴**
```bash
pip install -r requirements.txt
```

3. **啟動系統**
```bash
python start_system.py
```

## 📋 系統架構

### 核心模組

#### 1. 主應用程序 (`main.py`)
- Qt主視窗和UI管理
- 標籤頁和功能整合
- 事件處理和狀態管理

#### 2. 資料管理器 (`data_manager.py`)
- YAML檔案讀寫
- 藥物和處方籤CRUD操作
- 備份和恢復功能
- 資料驗證和清理

#### 3. ROS2介面 (`ros2_interface.py`)
- ROS2節點管理
- 串行訂單處理
- 藥物資訊服務
- 狀態回調處理

#### 4. 對話框模組
- `medicine_dialog.py`: 藥物新增/編輯
- `prescription_dialog.py`: 處方籤管理
- `settings_dialog.py`: 系統設定

### 資料結構

#### 藥物資料 (medicines.yaml)
```yaml
medicines:
  - id: "M001"
    name: "阿司匹林"
    english_name: "Aspirin"
    category: "解熱鎮痛藥"
    dosage_form: "錠劑"
    strength: "100mg"
    manufacturer: "台灣拜耳"
    stock_quantity: 500
    unit: "錠"
    price: 15.5
    description: "用於解熱、鎮痛、抗發炎"
    side_effects: "可能引起胃部不適"
    storage_conditions: "室溫保存"
    expiry_date: "2025-12-31"
```

#### 處方籤資料 (prescriptions.yaml)
```yaml
prescriptions:
  - id: "P20241202001"
    patient_name: "張小明"
    patient_id: "P001"
    doctor_name: "李醫師"
    timestamp: "2024-12-02T10:30:00"
    status: "completed"
    medicines:
      - medicine_id: "M001"
        medicine_name: "阿司匹林"
        dosage: "100mg"
        frequency: "每日三次"
        quantity: 30
        notes: "飯後服用"
    total_price: 465.0
    notes: "感冒發燒"
```

## 🔄 串行訂單處理

### 處理流程
1. **訂單提交**: 使用者選擇處方籤進行處理
2. **佇列管理**: 系統將訂單加入待處理佇列
3. **串行處理**: 一次只處理一筆訂單
4. **狀態更新**: 即時更新處理狀態
5. **完成通知**: 處理完成後通知使用者

### 狀態管理
- `pending`: 等待處理
- `processing`: 處理中
- `completed`: 處理完成
- `failed`: 處理失敗

## 🤖 ROS2服務

### 藥物資訊服務
- **查詢藥物**: 獲取單個或所有藥物資訊
- **新增藥物**: 創建新的藥物記錄
- **更新藥物**: 修改現有藥物資訊
- **刪除藥物**: 移除藥物記錄

### 訂單處理服務
- **訂單提交**: 提交處方籤處理請求
- **狀態查詢**: 查詢訂單處理狀態
- **結果回報**: 回報處理結果

### 主題通訊
- `/medicine/prescription_request`: 處方籤處理請求
- `/medicine/prescription_response`: 處方籤處理回應
- `/medicine/system_status`: 系統狀態更新
- `/medicine/info_request`: 藥物資訊請求
- `/medicine/info_response`: 藥物資訊回應

## ⚙️ 系統設定

### 一般設定
- 自動儲存間隔
- 備份設定
- 庫存警告閾值
- 過期警告天數

### ROS2設定
- Domain ID
- 節點名稱
- 服務和主題名稱
- 自動連接設定

### 資料設定
- 資料目錄路徑
- 備份和匯出設定
- 資料清理規則
- 匯出格式設定

### 進階設定
- 效能參數
- 日誌設定
- 除錯模式
- 動畫效果

## 📊 功能模組

### 💊 藥物管理
- 藥物資訊的新增、編輯、刪除
- 庫存管理和警告
- 分類和劑型管理
- 搜尋和篩選功能

### 📋 處方籤管理
- 處方籤創建和編輯
- 藥物選擇和劑量設定
- 處理狀態追蹤
- 歷史記錄查詢

### 📦 庫存管理
- 庫存概覽和統計
- 低庫存警告
- 過期藥物提醒
- 庫存價值計算

### 🤖 ROS2通訊
- 連接狀態監控
- 訊息日誌
- 服務測試
- 系統資訊查詢

## 🔧 開發指南

### 添加新功能
1. 在對應模組中添加功能
2. 更新UI介面
3. 添加資料驗證
4. 更新ROS2服務（如需要）
5. 添加測試

### 自定義設定
- 修改 `settings_dialog.py` 添加新設定項
- 更新 `data_manager.py` 處理新設定
- 在主程序中應用新設定

### ROS2整合
- 定義新的服務介面
- 實現服務回調
- 添加主題訂閱
- 處理訊息格式

## 🐛 故障排除

### 常見問題

#### Q: ROS2連接失敗
**A:** 
- 檢查ROS2是否正確安裝
- 確認Domain ID設定
- 檢查防火牆設定

#### Q: 資料載入失敗
**A:**
- 檢查YAML檔案格式
- 確認檔案權限
- 查看錯誤日誌

#### Q: 訂單處理卡住
**A:**
- 檢查ROS2服務是否可用
- 查看處理日誌
- 重啟相關節點

### 除錯模式
啟用除錯模式可以獲得詳細的日誌資訊：
1. 打開系統設定
2. 進入進階設定標籤
3. 啟用除錯模式
4. 查看日誌檔案

## 📈 效能優化

### 建議設定
- 適當的重新整理間隔
- 合理的表格行數限制
- 定期清理舊資料
- 啟用自動備份

### 監控指標
- 記憶體使用量
- CPU使用率
- 網路通訊量
- 響應時間

## 🔒 安全性

### 資料保護
- 定期備份重要資料
- 加密敏感資訊
- 存取權限控制
- 日誌記錄

### 網路安全
- 使用安全的ROS2設定
- 限制網路存取
- 監控異常活動
- 定期更新

## 📞 支援

### 文件
- 詳細的API文件
- 使用手冊
- 開發指南
- 故障排除指南

### 社群
- GitHub Issues
- 討論區
- 技術支援
- 功能請求

## 📄 授權

本專案採用 MIT 授權條款。詳見 [LICENSE](LICENSE) 檔案。

## 🤝 貢獻

歡迎提交 Issue 和 Pull Request！

### 貢獻指南
1. Fork 專案
2. 創建功能分支
3. 提交變更
4. 發起 Pull Request

---

**🎉 感謝使用 Qt藥物管理系統！**