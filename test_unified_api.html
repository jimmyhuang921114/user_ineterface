<!DOCTYPE html>
<html>
<head>
    <title>測試 Unified API</title>
</head>
<body>
    <h1>測試 Unified Medicine API</h1>
    
    <h2>測試 1: 只有基本資料</h2>
    <button onclick="testBasicOnly()">測試基本資料</button>
    
    <h2>測試 2: 基本 + 詳細資料</h2>
    <button onclick="testUnified()">測試統一資料</button>
    
    <h2>結果</h2>
    <div id="result" style="border: 1px solid #ccc; padding: 10px; margin-top: 10px;"></div>
    
    <script>
        async function testBasicOnly() {
            const data = {
                basic_data: {
                    name: "測試藥物-基本",
                    amount: 50,
                    position: "A1-01",
                    manufacturer: "測試製造商",
                    dosage: "100mg",
                    prompt: "這是測試AI提示"
                },
                detailed_data: null
            };
            
            await sendRequest(data, "基本資料測試");
        }
        
        async function testUnified() {
            const data = {
                basic_data: {
                    name: "測試藥物-統一",
                    amount: 100,
                    position: "B2-03",
                    manufacturer: "統一製造商",
                    dosage: "200mg",
                    prompt: "統一測試AI提示"
                },
                detailed_data: {
                    description: "這是統一測試藥物",
                    ingredient: "測試成分",
                    category: "測試分類",
                    usage_method: "口服，每日三次",
                    side_effects: "可能會有輕微副作用"
                }
            };
            
            await sendRequest(data, "統一資料測試");
        }
        
        async function sendRequest(data, testName) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `<p>正在測試 ${testName}...</p>`;
            
            try {
                console.log('發送資料:', JSON.stringify(data, null, 2));
                
                const response = await fetch('/api/medicine/unified', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                console.log('回應:', result);
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <h3>${testName} - 成功 ✅</h3>
                        <p><strong>狀態:</strong> ${response.status}</p>
                        <p><strong>訊息:</strong> ${result.message}</p>
                        <details>
                            <summary>詳細回應</summary>
                            <pre>${JSON.stringify(result, null, 2)}</pre>
                        </details>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <h3>${testName} - 失敗 ❌</h3>
                        <p><strong>狀態:</strong> ${response.status}</p>
                        <p><strong>錯誤:</strong> ${result.detail || result.message}</p>
                        <details>
                            <summary>詳細錯誤</summary>
                            <pre>${JSON.stringify(result, null, 2)}</pre>
                        </details>
                    `;
                }
            } catch (error) {
                console.error('請求錯誤:', error);
                resultDiv.innerHTML = `
                    <h3>${testName} - 異常 ⚠️</h3>
                    <p><strong>錯誤:</strong> ${error.message}</p>
                `;
            }
        }
    </script>
</body>
</html>